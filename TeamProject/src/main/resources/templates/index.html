<!DOCTYPE html>
<html lang="ko" xmlns:th="http://www.thymeleaf.org">
<head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no" />
    <meta name="description" content="" />
    <meta name="author" content="" />
    <title>상크스</title>
    <!-- Favicon-->
    <link rel="icon" type="image/x-icon" th:href="@{assets/favicon.ico}" />
    <!-- Bootstrap icons-->
    <link th:href="@{https://cdn.jsdelivr.net/npm/bootstrap-icons@1.10.0/font/bootstrap-icons.css}" rel="stylesheet" />
    <!-- Core theme CSS (includes Bootstrap)-->
    <link th:href="@{css/index_styles.css}" rel="stylesheet" />
    <!-- JQuery -->
    <script th:src="@{https://ajax.googleapis.com/ajax/libs/jquery/3.6.4/jquery.min.js}"></script>
</head>
<body>
<!-- Navigation-->
<div th:replace="/fragments/header.html :: fragment-header"></div>
<!-- search -->
<nav class="navbar navbar-expand-lg">
    <div class="container px-4 px-lg-5">
        <div class="collapse navbar-collapse" id="navbarSupportedContent"></div>
        <!-- 지도 위에 표시될 마커 카테고리 -->
        <div class="category-wrapper">
            <button class="category-button" id="chickenMenu" onclick="changeMarker('chicken')">치킨</button>
            <button class="category-button" id="pizzaMenu" onclick="changeMarker('pizza')">피자</button>
            <button class="category-button">카테고리 3</button>
            <button class="category-button" style="margin-right: 50px;">카테고리 4</button>
        </div>
        <form class="d-flex" role="search">
            <input class="form-control me-2" type="search" placeholder="Search" aria-label="Search">
            <button class="btn btn-outline-dark" type="submit">Search</button>
        </form>
    </div>
    </div>
</nav>
<!-- Section-->
<section class="py-4">

    <div id="mapwrap">
        <!-- 지도가 표시될 div -->
        <div id="map" style="width:100%;height:600px;"></div>
    </div>

</section>
<!-- Footer-->
<div th:replace="/fragments/footer.html :: fragment-footer"></div>
<!-- Bootstrap core JS-->
<script th:src="@{https://cdn.jsdelivr.net/npm/bootstrap@5.2.3/dist/js/bootstrap.bundle.min.js}"></script>
<script type="text/javascript" src="//dapi.kakao.com/v2/maps/sdk.js?appkey=db639de31c3c82f94d530caff88b4d6d"></script>
<script th:inline="javascript">
    var storeList = /*[[${storeList}]]*/ {};

    var mapContainer = document.getElementById('map'), // 지도를 표시할 div
        mapOption = {
            center: new kakao.maps.LatLng(35.8929027578229, 128.64565835012), // 지도의 중심좌표
            level: 3 // 지도의 확대 레벨
        };

        // 지도를 생성합니다
    var map = new kakao.maps.Map(mapContainer, mapOption);

    var chickenPositions = [];
    var pizzaPositions = [];
    //분류
    for (var i = 0; i < storeList.length; i++) {
        var store = storeList[i];
        if (store.dtlStateNm === '영업') {
            if (store.uptaeNm === '호프/통닭' || store.uptaeNm === '통닭(치킨)') {
                chickenPositions.push(new kakao.maps.LatLng(store.y, store.x));
                if(store.bplcNm.includes("피자")){
                    pizzaPositions.push(new kakao.maps.LatLng(store.y, store.x));
                }
            } else {
                pizzaPositions.push(new kakao.maps.LatLng(store.y, store.x));
            }
        }
    }

    var markerImageSrc = 'https://t1.daumcdn.net/localimg/localimages/07/mapapidoc/category.png';  // 마커이미지의 주소입니다. 스프라이트 이미지 입니다
    chickenMarkers = [], // 치킨집 마커 객체를 가지고 있을 배열입니다
    pizzaMarkers = [], // 피자집 마커 객체를 가지고 있을 배열입니다

    createChickenMarkers(); // 치킨집 마커를 생성하고 치킨집 마커 배열에 추가합니다
    createPizzaMarkers(); // 피자집 마커를 생성하고 피자집 마커 배열에 추가합니다

    // changeMarker('chicken'); // 지도에 치킨집 마커가 보이도록 설정합니다

    // 마커이미지의 주소와, 크기, 옵션으로 마커 이미지를 생성하여 리턴하는 함수입니다
    function createMarkerImage(src, size, options) {
        var markerImage = new kakao.maps.MarkerImage(src, size, options);
        return markerImage;
    }

    // 좌표와 마커이미지를 받아 마커를 생성하여 리턴하는 함수입니다
    function createMarker(position, image) {
        var marker = new kakao.maps.Marker({
            position: position,
            image: image
        });

        return marker;
    }

    // 치킨집 마커를 생성하고 치킨집 마커 배열에 추가하는 함수입니다
    function createChickenMarkers() {

        for (var i = 0; i < chickenPositions.length; i++) {

            var imageSize = new kakao.maps.Size(22, 26),
                imageOptions = {
                    spriteOrigin: new kakao.maps.Point(10, 0),
                    spriteSize: new kakao.maps.Size(36, 98)
                };

            // 마커이미지와 마커를 생성합니다
            var markerImage = createMarkerImage(markerImageSrc, imageSize, imageOptions),
                marker = createMarker(chickenPositions[i], markerImage);

            // 생성된 마커를 치킨집 마커 배열에 추가합니다
            chickenMarkers.push(marker);
        }
    }

    // 치킨집 마커들의 지도 표시 여부를 설정하는 함수입니다
    function setChickenMarkers(map) {
        for (var i = 0; i < chickenMarkers.length; i++) {
            chickenMarkers[i].setMap(map);

            // // 커스텀 오버레이에 표출될 내용으로 HTML 문자열이나 document element가 가능합니다
            // var content = '<div class="customoverlay">' +
            //         `<span class="title">${storeList.bplcNm}</span>` +
            //     '</div>';

            // // 커스텀 오버레이를 생성합니다
            // var customOverlay = new kakao.maps.CustomOverlay({
            //     map: map,
            //     position: position,
            //     content: content,
            //     yAnchor: 1
            // });

        }
    }

    // 피자집 마커를 생성하고 치킨집 마커 배열에 추가하는 함수입니다
    function createPizzaMarkers() {

        for (var i = 0; i < pizzaPositions.length; i++) {

            var imageSize = new kakao.maps.Size(22, 26),
                imageOptions = {
                    spriteOrigin: new kakao.maps.Point(10, 0),
                    spriteSize: new kakao.maps.Size(36, 98)
                };

            // 마커이미지와 마커를 생성합니다
            var markerImage = createMarkerImage(markerImageSrc, imageSize, imageOptions),
                marker = createMarker(pizzaPositions[i], markerImage);

            // 생성된 마커를 피자집 마커 배열에 추가합니다
            pizzaMarkers.push(marker);
        }
    }

    // 피자집 마커들의 지도 표시 여부를 설정하는 함수입니다
    function setPizzaMarkers(map) {
        for (var i = 0; i < pizzaMarkers.length; i++) {
            pizzaMarkers[i].setMap(map);
        }
    }

    // 카테고리를 클릭했을 때 type에 따라 카테고리의 스타일과 지도에 표시되는 마커를 변경합니다
    function changeMarker(type) {

        var chickenMenu = document.getElementById('chickenMenu');
        var pizzaMenu = document.getElementById('pizzaMenu');

        // 치킨집 카테고리가 클릭됐을 때
        if (type === 'chicken') {

            // 치킨집 카테고리를 선택된 스타일로 변경하고
            chickenMenu.className = 'menu_selected category-button';

            // 나머지 카테고리는 선택되지 않은 스타일로 바꿉니다
            pizzaMenu.className = 'category-button';

            // 치킨집 마커들만 지도에 표시하도록 설정합니다
            setChickenMarkers(map);
            setPizzaMarkers(null);

        } else if (type === 'pizza') { // 피자집 카테고리가 클릭됐을 때

            // 피자집 카테고리를 선택된 스타일로 변경하고
            chickenMenu.className = 'category-button';
            pizzaMenu.className = 'menu_selected category-button';

            // 피자집 마커들만 지도에 표시하도록 설정합니다
            setChickenMarkers(null);
            setPizzaMarkers(map);
        }
    }

</script>
</body>

</html>